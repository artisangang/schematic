"use strict";var schematic=function(){function e(e,t){this.name=e,this.dom=null,this.config=t,this._booted=!1,this._models={},this._services=[]}function t(t,n){return"undefined"!=typeof l[t]?l[t]:l[t]=new e(t,n)}function n(e,t,n){var r,o=[];for(var i in e){var a=e[i];"function"==typeof a?r=a:o.push(t(a,n))}if("function"!=typeof r)throw new Error("Invalid object in injector.");return r.apply(r,o)}function r(e){return n(e,o)}function o(e){if("string"==typeof e&&"undefined"!=typeof p[e]){if("function"==typeof p[e]){p[e.replace("@","")];return new p[e]}return p[e]}throw new Error("Unknown reference "+e+" in injector.")}function i(e,t){var r;if("string"==typeof e&&"undefined"!=typeof d[e]){var o=d[e];return r=o instanceof Array?n(o,a):o(),r.meta=t,t.app._services.push(r),r}throw new Error("Unknown service provider "+e+" in injector.")}function a(e){if(0==e.indexOf("@"))return o(e);if(0==e.indexOf("#"))return i(e);throw new Error("Invalid dependency "+e+".")}function s(e,t){p["@"+e]=t}function c(e,t){if("function"!=typeof t&&!(t instanceof Array))throw new Error("Invalid Service provider "+e+" found.");if("undefined"!=typeof d[e])throw new Error("Service provider with name "+e+" already exists.");d["#"+e]=t}function f(e,t){var n=o("@decorator");for(var r in t){var i=e.name+" "+t[r].title,a=i.slug(),s=t[r].data,c=[];for(var f in s){var u=s[f],l=[u.name];if("text"==u.type||"password"==u.type||"file"==u.type||"email"==u.type){var p=n.element("input",{type:u.type,name:u.name}).get();l.push(p)}l.push(u.description||""),l.push(u.param_type||"string"),l.push(u.data_type||"string"),c.push(l)}var d=n.element("button",{class:"schematic-btn",onclick:"","data-target":a}).text("Try Now").get(),h=n.table({});h.header(["Parameter","Value","Description","Parameter Type","Data Type"]),h.tbody(c),h.footer([{html:d,colSpan:5}],!0);var v=h.get(),m=n.element("span",{class:"method"}).text(t[r].method||"get").get(),y=n.element("span",{class:"action"}).text(t[r].action||"/").get(),w=n.element("div",{class:"heading"}).text(t[r].title||"").get();w.appendChild(m),w.appendChild(y);var g=n.element("div",{class:"panel "+(t[r].method||"get")}).get();g.appendChild(w);var b=n.element("div",{class:"body collapsey"}).get(),E=n.element("div",{class:"body-content"}).get(),T=n.element("form",{class:"schematic-form",id:a}).get();T.appendChild(v),E.appendChild(T),b.appendChild(E),g.appendChild(b),e.dom.appendChild(g)}}function u(t,n){if(!(n instanceof Node))throw new Error("Invalid application "+t+" dom reference.");if(!l[t]instanceof e)throw new Error("Application "+t+" doesn't exists.");if(l[t]._booted)throw new Error("Application "+t+" is already running.");n.setAttribute("class",(n.getAttribute("class")||"")+" schematic-dom"),l[t].dom=n,l[t]._booted=!0;for(var r in l[t]._services){var o=l[t]._services[r];o.init()}var i;(i=n.getAttribute("data-model"))&&f(l[t],l[t]._models[i])}var l={},p={},d={};return e.prototype.init=function(e){n(e,i,{app:this})},e.prototype.model=function(e,t){this.config.routable&&console.info("Application will not use ["+e+"] model in routable mode."),this._models[e]=t},s("stage",{draw:f}),document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",this,!1);for(var e in l){var t=document.querySelectorAll('[data-schematic="'+e+'"]');t.length&&(t.length>1&&console.info("Duplicate application reference found in dom."),u(e,t[0]))}}),{app:t,injector:r,register:s,boot:u,get:o,service:c}}();schematic.register("helpers",function(){return String.prototype.slug=function(){return this.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")},this.toAttributes=function(e,t){var n=[];return Object.keys(e).map(function(r){var r="string"==typeof t?t+r:r;n.push(t+"="+e[r])}),n.join(" ")},this.serializeToQS=function(e,t){var n=[];for(var r in e)if(e.hasOwnProperty(r)){var o=t?t+"["+r+"]":r,i=e[r];n.push("object"==typeof i?this.serializeToQS(i,o):encodeURIComponent(o)+"="+encodeURIComponent(i))}return n.join("&")},this}),schematic.register("xhr",function(){var e,t=void 0,n="get",r={"Content-type":"application/x-www-form-urlencoded",Accept:"application/json"},o=null,i={};document.createEvent?(e=document.createEvent("HTMLEvents"),e.initEvent("xhrSuccess",!0,!0)):(e=document.createEventObject(),e.eventType="xhrSuccess"),e.eventName="xhrSuccess";var a;document.createEvent?(a=document.createEvent("HTMLEvents"),a.initEvent("xhrError",!0,!0)):(a=document.createEventObject(),a.eventType="xhrError"),a.eventName="xhrError";var s=function(e){if(document.createEvent)try{document.dispatchEvent(e)}catch(e){console.info("Unable to dispatch event xhrEvent.")}else document.fireEvent("on"+e.eventType,e)},c=schematic.get("@helpers");return this.create=function(f,u,l){var l=l||"",u=u||n;if("object"==typeof l&&(l instanceof FormData?delete r["Content-Type"]:l=c.serializeToQS(l)),["get","post","put","delete"].indexOf(u.toLowerCase())<0)throw new Error("Invalid request method "+u);if(n=u,t=f,"undefined"!=typeof XMLHttpRequest)o=new XMLHttpRequest;else for(var p=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],d=0,h=p.length;d<h;d++)try{o=new ActiveXObject(p[d]);break}catch(e){}o.onreadystatechange=function(){if(!(o.readyState<4))return 200!==o.status&&"function"==typeof i.error?(a.status=o.status,a.response=o.responseText,s(a),i.error(o.status,o.responseText)):4===o.readyState&&"function"==typeof i.then&&200===o.status?(e.status=o.status,e.response=o.response,s(e),i.then(o.response,o.status)):void 0},o.open(n,t,!0),Object.keys(r).map(function(e){o.setRequestHeader(e,r[e])}),o.send(l);var v=new function(){return this.then=function(e){if("function"!=typeof e)throw new Error("Invalid callback in then.");return i.then=e,this},this.error=function(e){if("function"!=typeof e)throw new Error("Invalid callback in error.");return i.error=e,this},this};return v},this}),schematic.register("decorator",function(){schematic.get("@helpers");return this.table=function(e){var t=this.element("table",{class:"schematic-table"}).get();return this.header=function(e,n){var r=t.createTHead();if("boolean"==typeof n&&1==n){var o=0,i=r.insertRow(o),a=0;for(var s in e){var c=e[s],f=i.insertCell(a);f.innerHTML=c.html,"undefined"!=typeof c.colSpan&&(f.colSpan=c.colSpan),a++}}else{var i=r.insertRow(0),a=0;for(var s in e){var f=i.insertCell(a);f.innerHTML="<strong>"+e[s]+"</strong>",a++}}return this},this.footer=function(e,n){var r=t.createTFoot();if("boolean"==typeof n&&1==n){var o=0,i=r.insertRow(o),a=0;for(var s in e){var c=e[s],f=i.insertCell(a);"string"==typeof c.html?f.innerHTML=c.html:c.html instanceof HTMLElement&&f.appendChild(c.html),"undefined"!=typeof c.colSpan&&(f.colSpan=c.colSpan),a++}}else{var i=r.insertRow(0),a=0;for(var s in e){var f=i.insertCell(a);f.innerHTML=e[s],a++}}return this},this.tbody=function(e){var n=t.createTBody();for(var r in e){var o=e[r],i=n.insertRow(r);for(var a in o){var s=i.insertCell(a);"string"==typeof o[a]?s.innerHTML=o[a]:o[a]instanceof HTMLElement?s.appendChild(o[a]):"object"==typeof o[a]&&(s.innerHTML=o[a].toString())}}},this.get=function(){return t},this.toString=function(){return t.innerHTML},this},this.element=function(e,t,n){var r=document.createElement(e);"string"==n&&(r.innerHTML=n);for(var o in t)r.setAttribute(o,t[o]);return this.text=function(e){return r.textContent=e,this},this.get=function(){return r},this.toString=function(){return r.innerHTML},this},this}),schematic.service("router",["@xhr","@stage",function(e,t){function n(n,o){if("string"==typeof o){var i=o;i.indexOf("http")<0&&(i=s+o),e.create(i).then(function(e){if("string"==typeof e&&(e=JSON.parse(e)),!(e instanceof Array))throw new Error("Invalid model "+o);t.draw(r.meta.app,e)}).error(function(e,t){})}}var r={},o={},i=null,a="eager",s="",c=!1;return r.url=function(e){s=e},r.html5=function(){c=!0},r.fetchMode=function(e){if(["eager","lazy"].indexOf(e)<0)throw new Error("Invalid fetch mode.");a=e},r.on=function(e,t){o[e]=t},r.default=function(e){i=e},r.test=function(){alert("router in...")},r.init=function(){r.meta.app.routable=!0;var e=function(){var e=window.location.hash.replace("#","");"undefined"!=typeof o[e]?n(e,o[e]):null!=i&&(window.location.hash="#"+i)};window.onhashchange=e,window.location.hash&&e(),window.location.hash="#"+i},r}]);